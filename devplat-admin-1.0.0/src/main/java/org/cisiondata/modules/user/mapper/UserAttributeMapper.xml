<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.cisiondata.modules.user.dao.UserAttributeDAO">
	<resultMap type="org.cisiondata.modules.auth.entity.UserAttribute" id="UserAttributeModelMap">
		<id property="id" column="ID"/>
		<result column="USER_ID" property="userId" javaType="long"/>
		<result column="KEY" property="key"/>
		<result column="VALUE" property="value"/>
		<result column="TYPE" property="type"/>
	</resultMap>
	
	<resultMap type="org.cisiondata.modules.user.entity.AUser" id="AUserModelMap">
		<id property="id" column="ID"/>
		<result column="ACCOUNT" property="account"/>
		<result column="PASSWORD" property="password"/>
		<result column="SALT" property="salt"/>
		<result column="IDENTITY" property="identity"/>
		<result column="NICK_NAME" property="nickname"/>
		<result column="REAL_NAME" property="realname"/>
		<result column="ID_CARD" property="idCard"/>
		<result column="MOBILE_PHONE" property="mobilePhone"/>
		<result column="MAC_ADDRESS" property="macAddress"/>
		<result column="EMAIL" property="email"/>
		<result column="STATUS" property="status"/>
		<result column="CREATE_TIME" property="createTime"/>
		<result column="EXPIRE_TIME" property="expireTime"/>
		<result column="DELETE_FLAG" property="deleteFlag"/>
	</resultMap>
	
	<!-- 新增用户属性 -->
	<insert id="addUserAttribte" parameterType="org.cisiondata.modules.auth.entity.UserAttribute">
		insert into T_USER_ATTRIBUTE(USER_ID,`KEY`,`VALUE`,TYPE)
		value (#{userId},#{key},#{value},#{type})
	</insert>
	<!-- 根据USER_ID和KEY查询-->
	<select id="findAUserAttribte" parameterType="org.cisiondata.modules.auth.entity.UserAttribute" resultMap="UserAttributeModelMap">
		select * from T_USER_ATTRIBUTE
		<where>
			<if test="userId !=null">USER_ID=#{userId}</if>
			<if test="key !=null and key != ''">and `KEY`=#{key}</if>
		</where>
	</select>
	
	<!-- 根据USER_ID和KEY修改VALUE -->
	<update id="updateUserAttribte" parameterType="org.cisiondata.modules.auth.entity.UserAttribute">
		update T_USER_ATTRIBUTE set `VALUE`=#{value} where USER_ID=#{userId} and `KEY`=#{key}
	</update>
	
	
	<!--根据map条件查询  -->
	<select id="findByCondition" parameterType="map" resultMap="UserAttributeModelMap" >
	select * from T_USER_ATTRIBUTE 
		<where>
			<if test="userId!=null and userId!=''">USER_ID=#{userId}</if>
			<if test="key!=null and key!=''">and `KEY`=#{key}</if>
		</where> 
	</select>
	
	
	<!--根据id查询全部用户-->
	<select id="findallAuser" resultMap="AUserModelMap">
		SELECT * FROM T_USER WHERE IDENTITY=5
		<if test="begin != null and pageSize != null">
    		limit #{begin},#{pageSize}
    	</if>
	</select>
	
	<!--修改用户金额-->
	<update id="updateRemainingMoney" >
	UPDATE T_USER_ATTRIBUTE SET VALUE=#{money} WHERE USER_ID=#{userId} AND `KEY`='remainingMoney'
	</update>
	
</mapper>